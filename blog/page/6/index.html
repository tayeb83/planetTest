
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="The Mozillians are visiting Latin America as part of their MDN Spring Tour. On Tuesday, April 24th, they&#8217;ll be offering a developr evening in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tayeb83.github.io/planetTest/blog/page/6">
  <link href="/planetTest/favicon.png" rel="icon">
  <link href="/planetTest/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/planetTest/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/planetTest/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/planetTest/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tayeb83.github.io/planetTest" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/planetTest/">Blog</a></li>
  <li><a href="/planetTest/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/04/19/mozilla-developer-network-hack-day-montevideo-2012/">Mozilla Developer Network Hack Day Montevideo 2012</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Mozillians are visiting Latin America as part of their <a href="http://hacks.mozilla.org/2012/04/mozilla-hack-day-on-tour-heading-south/">MDN Spring Tour</a>. On Tuesday, April 24th, they&#8217;ll be offering a developr evening in <a href="http://g.co/maps/h9gnj">Café la diaria</a>. The event is sponsored by Mozilla, Cubox, La Diaria and BlueVia.</p>




<p><img class="center" src="http://blog.cuboxlabs.com/images/mozilla-event.jpg" title="Mozilla Developer Network Hack Day Montevideo 2012" ></p>




<p>Two of our Cuboxers will be giving talks this day: <strong><a href="http://mcdlr.com">Nicolas Barrera</a></strong> - <em>Responsive Web Design</em> and <strong><a href="http://picandocodigo.net">Fernando Briano</a></strong> - <em>Social Change through the web</em>.</p>




<p>Here&#8217;s the complete agenda for the event:</p>




<ul>
<li>17:30: doors open, lightning talk sign-up opens</li>
<li>18:15: Introductory remarks</li>
<li>18:30: How to make passwords on your site a thing of the past - Dan Mills <a href="http://twitter.com/@thunder">@thunder</a></li>
<li>19:00: Going Social - new Social APIs in the browser Shane Caraveo <a href="http://twitter.com/@mixedpuppy">@mixedpuppy</a></li>
<li>19:30: BlueVia developers program: platform and initiatives - Andres Leonardo Martinez Ortiz <a href="http://twitter.com/@davilagrau">@davilagrau</a></li>
<li>20:00: Responsive Web Design - Nicolas Barrera <a href="http://twitter.com/@DrummerHead">@DrummerHead</a></li>
<li>20:30: break</li>
<li>20:45: lightning talks</li>
<li>21:00: Social Change through the web - Fernando Briano <a href="http://twitter.com/@picandocodigo">@picandocodigo</a></li>
<li>21:30: JavaScript APIs - The web is the platform - Robert Nyman <a href="http://twitter.com/@robertnyman">@robertnyman</a></li>
<li>22:00: closing remarks, prizes, beer plan</li>
</ul>




<p>You can register to this event for free by following <a href="https://eventioz.com/events/mdn-hack-day-montevideo-developer-evening">this link</a>.</p>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/04/15/dependency-hell/">Dependency Hell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-15T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The recent wave of hate about Go&#8217;s dependencies management and subsequent wave of ideas on
how to &#8220;fix&#8221; it, i.a. <a href="https://github.com/kr/goven">goven by Keith Rarick</a> and
<a href="http://groups.google.com/group/golang-nuts/browse_thread/thread/d1abee8965114909/b48d73c43943b9bc">this thread</a>
on the go-nuts mailing list pushed me to some thoughts. In this post we
will take a closer look at the <em>problem</em> so many people found in Go
and possible solutions for it.</p>




<h3 id="The+problem(?)">The problem(?)</h3>




<p>First of all&#8230; what&#8217;s the problem? That evil thing, shouted loudly by
everyone is that the current way of dependency management does <strong>not protect</strong>
them against bugs and changes in external packages. Some external
dependency may change and break our code in the future or break our
production environment!</p>




<div class="meme">
  <img src="http://areyoufuckingcoding.me/img/meme-omg.jpg" alt="OMG">
</div>




<p>Hmm, is that actually the problem? IMHO that&#8217;s not the real problem but
just the effect of another, separate problem. Namely: misunderstanding of versioning
and dependencies recognition. So, let&#8217;s clarify some things, and
let&#8217;s do it from very very beginning&#8230;</p>




<p>So, what&#8217;s <strong>software versioning</strong>? Or more explicitly, why do we need
software versioning? Speaking shortly, <strong>software versioning is the way
to distinguish changes in the code</strong>. The main job of versioning is to
tell developers what has changed between the different versions. It also
serves users by telling them  whether their software is stable or not, or to
make the bug reporting process easier and more accurate.</p>




<p>Now, what&#8217;s the <strong>dependency</strong>? Dependency my friends is <strong>someone elses&#8217;s
piece of crap without which your piece of crap doesn&#8217;t work</strong>.</p>




<h3 id="Versioning+vs.+dependencies+resolving">Versioning vs. dependencies resolving</h3>




<p>Now, some homework for you guys&#8230; Find a reasonable relationship between
software versioning and dependencies resolving.</p>




<p>Speaking for myself, I found none. Because there are no relationships
between them. Software versioning and dependencies resolving are totally
different things. Now I can already hear you guys screaming:</p>




<blockquote>
  So how can I specify on which version of the software my code depends?
</blockquote>




<p>And here we are: <strong>You don&#8217;t have to know that</strong>! Let me put it
this way: your code depends on packages <em>X</em> and <em>Y</em>. Now, package
<em>Y</em> also depends on package <em>X</em>. If you make both dependencies
fixed on an explicit version (or range of versions) then you may cause
<strong>dependency hell</strong> between those packages or get blocked in
the future. For example you may not be able update <em>Y</em> without
updating <em>X</em>.</p>




<p>Once again, this is not the problem, only a side effect of using versions
in deps resolving. Of course, instead of eliminating the source of the
problem many people try to make the effect less painful - like the
Bundler gem in ruby or some super smart package managers. <strong>But you don&#8217;t
need that</strong>. In case of dependency management you <strong>should depend
on the major version exclsively</strong> - moreover, you should consider
different major versions as <strong>different packages</strong> (eg. <em>foo-1.0</em>
and <em>foo-2.0</em> should be treated as different package with no relation
whatsoever between them, more explicitly <em>foo1</em> != <em>foo2</em>).</p>




<p>There&#8217;s also very important thing all the maintainers should know:
<strong>There should be no API changes between minor version changes and patch releases, motherfuckers!</strong>.</p>




<div class="meme">
  <img src="http://areyoufuckingcoding.me/img/meme-bugs-1.jpg" alt="Bugs, bugs, buuugs!">
</div>




<p>Yeah, but even if you follow the rules and you don&#8217;t change the API
between minor versions other problems or bugs might still pop up,
nobody&#8217;s perfect. What then?</p>




<p>The simplest solution is to just downgrade the package to the first
working version and report the bug, including infromation like from which
version you have being forced to downgrad and which one solved the problem.
<strong>This is the moment when versioning is usefull</strong>. This is also how
software improves and gets rid of bugs :P.</p>




<p>Anyway, now we&#8217;re finally comming back to the big <em>&#8220;problem&#8221;</em> that everybody seems to be whining about&#8230;</p>




<h3 id="I+can't+deploy+shit!">I can&#8217;t deploy shit!</h3>




<p>Now, again, I can just hear a bunch of pepole screaming:</p>




<blockquote>
  Are you fucking insane? I want to do a one click deploy without dealing
  with packages on the production server.
</blockquote>




<p>It&#8217;s reasonable that you want to make deploys fast and safe. But why do you
want to deal with those packages anyway? There&#8217;s one thing I can&#8217;t
understand at all: why the hell do you treat dependencies as a separate part of
the software!? If you work on production-ready applications, you should
not care about dependency management. Without this external piece of
crap your crap doesn&#8217;t work&#8230; more explicitly: this external crap
is part of your crap now. Instead of specifying a bunch of fixed dependencies
in a text file or complaining about the dependecy management in Go
just add this external stuff to your repository and <strong>keep it together</strong>.</p>




<p>Having all the dependencies versioned in your project&#8217;s repository
relieves you from having to care about the installation of dependencies in the production
environment - <strong>because you&#8217;re deploying the whole env</strong>. You also have
full flexibility to deal with the upgrading and downgrading of those
dependencies. If you use <code>git</code> then you can use <strong>submodules</strong>. If the
dependencies are versioned with <code>hg</code> then you can keep mercurial information
there and have access to the repo. You can also apply <strong>monkey patches
or bugfixes directly in your environment</strong>. Finally, you can keep
<strong>different versions of the packages for different projects</strong>.</p>




<h3 id="Go+approach">Go approach</h3>




<p>I hope that after the following examples the approach that spawned so many
controversies will finally be considered as a great feature, not a
problem. For those who don&#8217;t know how it works: Go&#8217;s import path is
3 in one - it shows from where to download the external package, where to install
it and later load it from at compile time, and what import name you should
use in your code:</p>




<pre><code class="language-go"><span class="k">import</span> <span class="s">"github.com/nu7hatch/gouuid"</span></code></pre>




<p>The convention is simple to implement and really powerful, but needs a
pivot in your programmer&#8217;s mindset. I also agree that it requires a few
tweaks to make it work in a handy way.</p>




<h3 id="Tweaking!">Tweaking!</h3>




<p>To make it work as expected first we should describe exactly what we
want to achieve. I want to tweak the Go tool in a way which will meet the
following requirements:</p>




<ol>
<li>I don&#8217;t want to change the code I wrote so far (no difference in import paths).</li>
<li>I want to keep tracking dependencies (be able to update/downgrade versions).</li>
<li>I want to be able to monkey patch or bugfix directly into the package.</li>
<li>I want to deploy code safely with a single command (safely = with the same effect
in production as in development).</li>
<li>I want to set a project up on a different machine with one command
(eg. to bootstrap another copy for some other developer).</li>
<li>Deployment should not be dependent on any external resources or repositories.</li>
</ol>




<p>The first point is obvious so we&#8217;ll just skip it. The second one - I want to track
dependencies, which means I don&#8217;t want to vendor them like <code>goven</code>
does. Point three affects the previous one as well - I want to keep track
of the external package and at the same time I want to be able to fix
it or change it. The remaining points are also obvious - we want to deploy or
setup our project as fast as possible - preferably with one command.</p>




<p>How do we implement something like this in real life? The first thing that came to
my mind was the <code>GOPATH</code> behaviour. I didn&#8217;t feel like it is really needed and I
had right, it&#8217;s not needed at all. Instead of specifying <code>GOPATH</code> or dealing with
it for different environments we can just add something unique which will allow
<code>go</code> tool to say <em>woot! we&#8217;re under gopath, let&#8217;s use local stuff now!</em>. It may be done
in the same way version control systems work - eg. by adding an empty <code>.go</code>
file to our environment:</p>




<pre><code>myappenv/
  .go
  bin/
  pkg/
  src/
</code></pre>




<p>The implementation is very simple. I just patched the <code>src/pkg/go/build.go</code> file
with this code:</p>




<pre><code class="language-go"><span class="k">func</span> <span class="n">discoverLocalGOPATH</span><span class="p">()</span> <span class="p">(</span><span class="n">gopath</span> <span class="nb">string</span><span class="p">,</span> <span class="n">ok</span> <span class="n">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">dotgo</span> <span class="nb">string</span>
        <span class="k">var</span> <span class="n">err</span> <span class="n">error</span>

        <span class="k">if</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">err</span> <span class="p">=</span> <span class="n">os</span><span class="p">.</span><span class="n">Getwd</span><span class="p">();</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">;</span> <span class="n">pwd</span> <span class="p">!=</span> <span class="s">"/"</span><span class="p">;</span> <span class="n">pwd</span> <span class="p">=</span> <span class="n">pathpkg</span><span class="p">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">dotgo</span> <span class="p">=</span> <span class="n">pathpkg</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="n">pwd</span><span class="p">,</span> <span class="s">".go"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="p">=</span> <span class="n">os</span><span class="p">.</span><span class="n">Stat</span><span class="p">(</span><span class="n">dotgo</span><span class="p">);</span> <span class="n">err</span> <span class="p">==</span> <span class="n">nil</span> <span class="p">{</span>
                        <span class="n">gopath</span><span class="p">,</span> <span class="n">ok</span> <span class="p">=</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">true</span>
                        <span class="k">return</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">defaultContext</span><span class="p">()</span> <span class="n">Context</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">c</span> <span class="n">Context</span>

        <span class="n">c</span><span class="p">.</span><span class="n">GOARCH</span> <span class="p">=</span> <span class="n">envOr</span><span class="p">(</span><span class="s">"GOARCH"</span><span class="p">,</span> <span class="n">runtime</span><span class="p">.</span><span class="n">GOARCH</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">GOOS</span> <span class="p">=</span> <span class="n">envOr</span><span class="p">(</span><span class="s">"GOOS"</span><span class="p">,</span> <span class="n">runtime</span><span class="p">.</span><span class="n">GOOS</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">GOROOT</span> <span class="p">=</span> <span class="n">runtime</span><span class="p">.</span><span class="n">GOROOT</span><span class="p">()</span>
        <span class="n">c</span><span class="p">.</span><span class="n">GOPATH</span> <span class="p">=</span> <span class="n">envOr</span><span class="p">(</span><span class="s">"GOPATH"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

        <span class="c1">// We have to prepend a local GOPATH if we find an `.go` file</span>
        <span class="c1">// in one of the parent locations of current directory.</span>
        <span class="k">if</span> <span class="n">localGOPATH</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:=</span> <span class="n">discoverLocalGOPATH</span><span class="p">();</span> <span class="n">ok</span> <span class="p">{</span>
                <span class="n">c</span><span class="p">.</span><span class="n">GOPATH</span> <span class="p">=</span> <span class="n">localGOPATH</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">c</span><span class="p">.</span><span class="n">GOPATH</span>
        <span class="p">}</span>

        <span class="c1">// *snip*</span></code></pre>




<p>That&#8217;s how we get rid of the annoying <code>GOPATH</code>, or actually make it more
useful and intuitive - different environments with no configuration at
all. The local env is recognized by its <code>.go</code> file and the path to this directory
will be prepended to <code>GOPATH</code>.</p>




<p>Now the hardest part - dependnecy tracking. Lets say our application
is <code>myappenv/src/acme.com/foobar</code> and depends on a few other packages.
Instead of versioning this application only and looking for the way
to track dependencies, let&#8217;s version <code>~/myappenv</code> directly. Lets do it
with git as an example:</p>




<pre><code>$ cd ~/myappenv
$ git init
</code></pre>




<p>If we depend on mercurial based projects, then it&#8217;s easy - just add them
to the repo with all the <code>hg</code> files. If we have git based dependencies
then it&#8217;s more tricky, because git doesn&#8217;t allow the tracking of nested repositories
without using submodules. It forces us to patch one more thing out there.
This time in the <code>src/cmd/go/vcs.go</code> file:</p>




<pre><code class="language-go"><span class="c1">// first we have to add submoduleCmd to vcs configurations:</span>
<span class="k">var</span> <span class="n">vcsGit</span> <span class="p">=</span> <span class="p">&amp;</span><span class="n">vcsCmd</span><span class="p">{</span>
       <span class="c1">// *snip*</span>
       <span class="n">submoduleCmd</span><span class="p">:</span> <span class="s">"submodule add {repo} {dir}"</span><span class="p">,</span>
       <span class="c1">// *snip*</span>
<span class="p">}</span>

<span class="c1">// ... Now we have to extend create function:</span>

<span class="k">func</span> <span class="p">(</span><span class="n">v</span> <span class="p">*</span><span class="n">vcsCmd</span><span class="p">)</span> <span class="n">create</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">repo</span> <span class="nb">string</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
        <span class="n">rootV</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:=</span> <span class="n">vcsForLocalRoot</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="p">{</span>
                <span class="n">dir</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="n">TrimLeft</span><span class="p">(</span><span class="n">strings</span><span class="p">.</span><span class="n">TrimLeft</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">root</span><span class="p">),</span> <span class="s">"/"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">rootV</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">rootV</span><span class="p">.</span><span class="n">submoduleCmd</span><span class="p">,</span> <span class="s">"dir"</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="s">"repo"</span><span class="p">,</span> <span class="n">repo</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"."</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">createCmd</span><span class="p">,</span> <span class="s">"dir"</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="s">"repo"</span><span class="p">,</span> <span class="n">repo</span><span class="p">)</span>
<span class="p">}</span></code></pre>




<p>To avoid overhead of code I can just tell you that <code>vcsForLocalRoot</code> func
checks if we&#8217;re in a local env, if so it checks if it&#8217;s versioned with
the same version control system as our dependency, and if so it adds that
dependency as a submodule instead of cloning it directly. Everything else
remains the same. <a href="http://code.google.com/r/chris-go/source/checkout">You can get the patched version and try it out</a>.</p>




<p>How do we use it now? Very simple - first of all throw your <code>GOPATH</code> configuration
away, you don&#8217;t need it anymore. There&#8217;s one more new feature added there,
the <code>init</code> command:</p>




<pre><code>$ go init ~/myappenv
</code></pre>




<p>You can also specify which version control system you want to use:</p>




<pre><code>$ go init -c hg ~/myappenv
</code></pre>




<p>This command will create the environment structure in a specified directory
(the directory doesn&#8217;t need to exist). I&#8217;m a lazy bastard, I didn&#8217;t add a
few things there yet, i.a you have to create the ignore file on your own,
it should contain:</p>




<pre><code>/bin/*
/pkg/*
</code></pre>




<p>You also have to make initial commit manually, eg:</p>




<pre><code>$ git add . &amp;&amp; git commit -m "hello go"
</code></pre>




<p>When you write some code and want to download dependencies, just run
<code>go get</code> as usual. Remember that you have to commit changes after
dependnecies are installed:</p>




<pre><code>$ cd ~/myappenv
$ go get ./...
$ git add . &amp;&amp; git commit -m "added X and Y deps"
</code></pre>




<h3 id="Bootstrap,+deploy...">Bootstrap, deploy&#8230;</h3>




<p>Using this approach you have the whole environment necessary to run
your application in one place, safely versioned in your application&#8217;s
repository. You can deploy or boostrap this application quickly and
in 2 steps.</p>




<pre><code>$ git clone git@acme.com:myappenv.git
$ cd ~/myappenv
$ git submodule init &amp;&amp; git submodule update
</code></pre>




<p>We can definitely call it a one click deploy :P. What&#8217;s more important,
the deploy doesn&#8217;t depend on any external sources, everything&#8217;s bundled
there with your project. We also have full control over each part of
the system - each dependency can be separately updated, changed or
patched. You can even replace the repository source with your monkey patched
fork without affecting the import paths in your sources!</p>




<div class="meme">
  <img src="http://areyoufuckingcoding.me/img/meme-marvelous-1.jpg" alt="Marvelous!">
</div>




<h3 id="Summary">Summary</h3>




<p>I&#8217;m curious about your oppinions and feedback about the stuff I wrote. From the short
reaserch I&#8217;ve been doing everyone appears to love getting rid of <code>GOPATH</code> in favor
of local environments. A few persons I asked around are still confused about
dealing with submodules - to be honest I&#8217;m not 100% convinced to this
approach yet, but so far it&#8217;s the best I&#8217;ve found and matches the requirements
I wrote down. I&#8217;m sure we can improve that part together. That&#8217;s all folks,
waiting for your comments.</p>




<p>Like always thanks to <a href="http://twitter.com/poteland">pote</a> for reviewing
my ugly english.</p>




<div class="author">
  <img src="https://twimg0-a.akamaihd.net/profile_images/1964798229/awesome2.jpg" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/nu7hatch">Krzysiek Kowalik</a> - check out <a href="http://areyoufuckingcoding.me">Are You Fucking Coding Me!?</a></i>
  </span>
</div>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/04/14/i-made-a-pretty-gem-planet-rb/">I Made a Pretty Gem - Planet.rb</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-14T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been hurting to write this ever since we had the idea of creating a Planet for <a href="http://cuboxlabs.com">Cubox</a>, a planet is - for those who have never heard the term - a static site
generated from all the posts in a given set of blogs, it&#8217;s pretty awesome, it allows organizations to have a place with all their coder&#8217;s posts on them without having to duplicate each post
on both the company blog and the coder&#8217;s.</p>




<h2><strong>Update</strong></h2>




<p>Since I published this I&#8217;ve been working like crazy on it, and some of this documentation might be outdated, please check <a href="http://github.com/pote/planet.rb">the github repo</a> for the latest available documentation. :)</p>




<h2>Wasn&#8217;t this invented like a million years ago?</h2>




<p>Yes, yes it was, this is nothing new, important examples of this concept can bee seen at <a href="http://planet.gnome.org/">Gnome</a> and <a href="http://planetkde.org/">KDE</a> planets, so I figured that there would already be solid technology behind this. I set out to get that code and implement it on our own shiny and geeky planet.</p>




<p>And then I saw the code.</p>




<p>I imagine both Gnome and KDA have moved on on their planet&#8217;s code, but I wasn&#8217;t able to find anything newer than <a href="http://www.planetplanet.org/">planetplanet.org</a>&#8217;s implementation. A codebase that hasn&#8217;t been touched for years (it requires python 2.2 for christ sake!!!)</p>




<p>I set out to patch the code to our needs, I created a github repo for planetplanet&#8217;s codebase and started working into adding some features, however I quickly found that it&#8217;s templating capabilities where horribly outdated, and frankly&#8230; well unusable, I love python, but I wanted to stab myself in the eye with the nearest fork while working with it, and it&#8217;s been theorized that eye stabbing is generally not good for your health, so I decided to rewrite the damn thing.</p>




<h2>Shut up already! Show me this marvelous code you are giving me for free!</h2>




<p>Allright, allright, shutting up now. Let&#8217;s assume that we have a shiny <a href="http://octopress.org">Octopress</a> blog that we want to turn into a planet. This is what we will do.</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>▸ ls
</span><span class='line'>CHANGELOG.markdown README.markdown    config.rb          public
</span><span class='line'>Gemfile            Rakefile           config.ru          sass
</span><span class='line'>Gemfile.lock       _config.yml        plugins            source</span></code></pre></td></tr></table></div></figure>




<p>Install the planet.rb gem</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>▸ gem install planet
</span><span class='line'>Successfully installed planet-0.0.1
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for planet-0.0.1...
</span><span class='line'>Installing RDoc documentation for planet-0.0.1...</span></code></pre></td></tr></table></div></figure>




<p>We want to go to the source directory and then create a basic planet.yml file that will contain your list of blogs</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>▸ cd source
</span><span class='line'>▸ planet init
</span><span class='line'>=&gt; created default planet.yml</span></code></pre></td></tr></table></div></figure>




<p>You will most likely want to edit this yml file (unless you really really like me and Cubox!), after you are done, run the generate command.</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>▸ planet generate
</span><span class='line'>=&gt; parsing http://blog.poteland.com/atom.xml
</span><span class='line'>=&gt; parsing http://blog.cuboxlabs.com/atom.xml
</span><span class='line'>=&gt; Found post titled Cubox brings back Ruby meetups to Montevideo - by Cubox
</span><span class='line'>=&gt; Found post titled We're hiring - by Cubox
</span><span class='line'>=&gt; Found post titled rubydeps - New gem by Cuboxer - by Cubox
</span><span class='line'>=&gt; Found post titled Cuboxers at wroc_love.rb in Poland - by Cubox
</span><span class='line'>=&gt; Found post titled Open Source Projects - by Cubox
</span><span class='line'>=&gt; Found post titled Machine learning in perspective - by Cubox
</span><span class='line'>=&gt; Found post titled Cubox on finances - by Cubox
</span><span class='line'>=&gt; Found post titled So what is Uruguay like? - by Cubox
</span><span class='line'>=&gt; Found post titled Supporting this weekend's Rails Bugmash - by Cubox
</span><span class='line'>=&gt; Found post titled One App in the App Store - by Cubox
</span><span class='line'>=&gt; Found post titled A new website - by Cubox
</span><span class='line'>=&gt; Found post titled Google Chrome OS: Obvious to the point of being boring. - by Cubox
</span><span class='line'>=&gt; Writing 12 posts to the _posts directory</span></code></pre></td></tr></table></div></figure>




<p>And that&#8217;s it! your _posts directory should be populated with all relevant posts from the blogs you&#8217;ve configured, and it&#8217;s ready to be deployed. :)</p>




<h2>Where&#8217;s the code? Can I break it?</h2>




<p>By all means! The code is public and lives on it&#8217;s <a href="https://github.com/pote/planet.rb">github repo</a>, suggestions (and better yet, patches!) are more than welcome!</p>




<h2>A quick note about Jekyll.</h2>




<p><a href="http://jekyllrb.com/">Jekyll</a> is awesome, and planet.rb can be easily used with it too, but I tend to favor Octopress as a simple-setup superset of Jekyll. Also, if you are using it, you probably don&#8217;t need my help to set your Jekyll planet up ;)</p>




<div class="author">
  <img src="http://poteland.com/images/avatars/red_mage.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/poteland">Pablo Astigarraga</a> - check out <a href="http://blog.poteland.com/">This is where I tell you stuff</a></i>
  </span>
</div>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/04/11/cubox-brings-back-ruby-meetups-to-montevideo/">Cubox Brings Back Ruby Meetups to Montevideo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-11T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last Tuesday Cubox hosted a new Ruby Meetup in Montevideo. 29 developers from the local community registered to <a href="http://www.meetup.com/rubymvd/events/58942322/">the meetup</a>. The invitation was open for developers of all technologies, and any knowledge level.</p>




<p><img class="center" src="http://blog.cuboxlabs.com/images/ruby-meetup-01.jpg" title="Ruby Meetup" ></p>




<p>We kicked off the meeting with a talk about <a href="http://soveran.github.com/cuba/">Cuba</a> the Ruby microframework for web development by <a href="http://elcuervo.co/">Bruno Aguirre</a>. He presented it as a minimal toolkit for web development from ground up.</p>




<p><img class="center" src="http://blog.cuboxlabs.com/images/ruby-meetup-02.jpg" title="Ruby Meetup" ></p>




<p>After the presentation, we had some pizza, sodas and beer. We shared lots of interesting conversations and met new faces from the community.</p>




<p>The Ruby meetups will be hosted every second Tuesday of the month. Companies are invited to sponsor future meetups by providing their offices or buying pizza and beer for the assistants. <a href="http://cuboxlabs.com/contact/">Contact us</a> if you&#8217;re interested.</p>




<p>We invite you to register at the <a href="http://www.meetup.com/rubymvd/">Ruby Meetup</a> page and attend these events, come share some knowledge, learn about Ruby and get to know what other developers are working on.</p>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/03/29/we-re-hiring/">We&#39;re Hiring</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We are looking for developers and web designers to join our <a href="http://cuboxlabs.com/people/">great team</a>. We value passion for the craft, open source contributions and teamwork. We embrace agile methodologies, test driven development and shipping value to our clients.</p>




<p><img class="center" src="http://blog.cuboxlabs.com/images/cubox-fridays.jpg" title="Cuboxers" >
Photo by: <a href="http://www.flickr.com/photos/foca/">Nicolas Sanguinetti</a></p>




<p>At Cubox, you can work on Open Source projects such as some of the examples <a href="http://cuboxlabs.com/quality/">here</a> or come up with your own. We have TechLunch and Code Review lunches weekly to keep us all in the loop of what we&#8217;re working at, and learn new stuff together. There&#8217;s also a ping pong table, free snacks, etc.</p>




<p>If you&#8217;re interested, check out <a href="http://cuboxlabs.com/people/work-with-us/">this page</a> to learn more and <a href="http://cuboxlabs.com/contact/">contact us</a>.</p>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/03/24/nothing-really-matters/">Nothing Really Matters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-24T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s been over a year since I joined <a href="http://cuboxlabs.com/">Cubox</a>. In the last
few days, visiting my motherland and participating in the amazing
<a href="http://wrocloverb.com">wroc_love.rb conference</a> led me to several reflections.
The fun is that all my technical and non-technical reflections
started joining together and clarifying my hacker&#8217;s mindset.</p>




<p>These reflections were also heaviliy inspired by many people, i.a. drunk
<a href="http://twitter.com/apotonick">apotonick</a> repeating all the time that
<strong>Nothing really matters</strong> :). Let me tell you how true this sentence is
in the case of your business, code and even life.</p>




<h3 id="To+hack+or+not+to+hack?">To hack or not to hack?</h3>




<p>I joined Cubox as a hacker, geek and crazy optimization monster, doing
a lot of cool stuff, tweaking things up, learning and enjoying the code.
This blog post will be a retrospection of all the things I screwed up and
the cool things I figured out during 2011. All the things about
designing applications, about building them, about choosing right tools&#8230;
and about the business behind all of this. It will be about my metamorphosis
from a typical optimization monster into devoted K.I.S.S. evangelist and
lean approach enthusiast. It will also show you how I understand Lean
Startup and how do I think lean code should look like.</p>




<h3 id="Integration+vs.+acceptance+testing">Integration vs. acceptance testing</h3>




<p>The first idea I was working on at the new job was a way to speed up slow Selenium
tests. I was figuring out many weird things, from improving speed of ExtJS,
through faster ruby driver for V8 engine and at the headless browser
C++ library ending. Woah, that was a total failure. It was like this&#8230;</p>




<blockquote>
Yeah, there&#8217;s V8 engine and it&#8217;s awesome, and there&#8217;s therubyracer
but is very slow so let&#8217;s speed it up, oh but if we use ExtJS it still
sucks, I can write everything in C&#8230;
</blockquote>




<p>But meanwhile I realized something way more important: instead of speeding up
the tool (a very complicated tool) we should speed our tests up. Besides
<strong>the idea of running integration tests is to test if all the parts of
a system are composed into one integral application in the production
environment</strong>. There&#8217;s no point to test the app in some virtual environment
which just simulates (poorly) all the others, widely used</p>




<p>Also, I started listening to many people around, and they all said
laudly and with confidence:</p>




<blockquote>
It&#8217;s Cucumber fault that our tests are slow! Cucumber is too slow!
</blockquote>




<p>Or others, including me:</p>




<blockquote>
It&#8217;s Rails fault! It&#8217;s too slow at boot so our tests are slow!
</blockquote>




<p>And we started using some pure RSpec tests based on Capybara, figuring out
how to optimize Rails etc. But it was the same&#8230; Capybara, Cucumber, RSpec
and Rails are only tools. They don&#8217;t matter, it&#8217;s <strong>only a delivery method</strong>
for some part of our logic. <strong>The logic which supposted to be tested</strong>.</p>




<p>A few days ago, I had a horrible hangover, drinking some <a href="https://twitter.com/#!/nu7hatch/status/179605961886015488">mate</a>
with <a href="http://twitter.com/DrummerHead">DrummerHead</a> and reading again
<a href="http://twitter.com/godfoca">godfoca&#8217;s</a> internal mail about the bussiness
value of splitting stories up into tasks (maybe he will publish it, worth
reading), juggling with some DCI papers around and listening to
<a href="http://confreaks.com/videos/759-rubymidwest2011-keynote-architecture-the-lost-years">Uncle Bob Martin&#8217;s talk at Ruby Midwest</a>.</p>




<p>Then I figured something out&#8230; Well I didn&#8217;t really, I just realized
something. I think that the user stories heavily and laudly promoted by BDD
and Cucumber are simply describing the wrong things. Let me put it this way:
they test things that don&#8217;t matter at all for your business. Take a look
at the story:</p>




<pre><code>As a bar client
In order to drink a beer
I want to go to the bar
Order a beer
And when I pay for it with cash
I want to see my beer on the table
</code></pre>




<p>Hey, guys, no offense&#8230; but that sounds retarded. Besides, that&#8217;s just
GUI testing! Some people may want to pay for the beer with a credit card, or open
a check and pay everything at the end. Others may want to order a beer from
the table without going to the bar. That kind of story doesn&#8217;t test
your business requiremenets, they don&#8217;t apply to your domain logic! Your
<code>Client</code> domains should be:</p>




<pre><code>- Drink a beer
- Be able to pay with cash or by card
- Be able to open check and pay at the end
</code></pre>




<p>You may notice that I don&#8217;t mention the <code>bar</code> at all, because that&#8217;s only
our <strong>delivery method</strong>, that&#8217;s only a framework which may change in the
future. Going to the <code>bar</code> is not <code>client</code> domain here. We may change <code>bar</code>
into <code>delivery service</code> or <code>cute blonde waitress</code> and his domain
doesn&#8217;t chage. He will be able to drink beer and pay for it however
he wants. <strong>Acceptance tests are supposed to test domain logic, not
the delivery method</strong>. The delivery method is only a tool, a plugin which
may be replaced at any time, without affecting your business model.
Delivery methods should be tested by an <strong>integration tool</strong> and be part
of the <strong>continuous integration process</strong> only!</p>




<p>Uncle Bob said something great, something I did repeat many times myself
but that some laud Rubyists around had different oppinions on:</p>




<blockquote>
The suite of tests is not there to satisfy the QA groups, it
is not there to prove to other people that our code works. The suite 
of tests is there so that we can refactor. So that when we bring the 
code up to our screen then we&#8217;re not afraid of it.
</blockquote>




<p>Think about it guys&#8230;</p>




<h3 id="More+and+more+hammers">More and more hammers</h3>




<p>The second thing I recently realized was how pathological the application
design process is. Most of the projects we star from scratch start in a
pointless discussion of which framework is better, what database
should we use, what templating system should we apply, etc. <strong>We are
discussing about unimportant crap</strong>!</p>




<blockquote>
- I bet we are gonna have a lot of writes, let&#8217;s use Cassandra! <br>
- Bullshit, there will be lot of reads too, Redis is best for that! <br>
- Fuck you! Let&#8217;s do something simple first and then optimize,
  we should start with MySQL! <br>
- I don&#8217;t want to live on this planet anymore&#8230; <br>
</blockquote>




<p>Maybe I am exaggerating, but there&#8217;s a lot of bootstrap conversations
that look like this. But you know what? <strong>nothing really matters</strong>&#8230;
Those who have seen Uncle Bob&#8217;s talk at Ruby Midwest should already
know that databases and frameworks are <strong>only tools</strong>, all this stuff,
all the hammers are <strong>only plugins</strong> and should be treated so.</p>




<h3 id="Lean+hacking?">Lean hacking?</h3>




<p>Thus, databases and frameworks are only delivery methods, we
don&#8217;t know at the beginning of a project which one to use anyway. To be lean you
have to deliver a minimum viable domain model to your users and learn
from how they react. <strong>The way how you deliver your domain logic
is not important at all</strong>.</p>




<p>The book &#8220;The Lean Startup&#8221;  has become extremally popular recently. It has
been especially adopted by all the Rails developers and dev shops.</p>




<blockquote>
Yeah, we&#8217;re fantastic because we can build a Rails app in 2 weeks
and validate your idea!
</blockquote>




<p>But again, Rails is only a tool, Rails doesn&#8217;t determine the process
of the lean product building. No tool does it! The <strong>Lean approach
is this one which allows you to validate your domain model quickly by
measuring reactions of the users of your product</strong>. A minimum viable
product. If you make the validation of your domain logic (your idea) depend
on the tool, on the framework or on the database then you&#8217;re not lean,
you are lost in dependencies&#8217; and tools&#8217; hell every time when you
want to change something. You are not lean, just an Agile Rails Development
shop or any other framework hyper! <strong>Lean is about eliminating any kind
of waste</strong>. Oh, what&#8217;s that? Aren&#8217;t all the dependencies, plugins
and tools which affect your domain model a waste?</p>




<h3 id="Clients+from+hell...">Clients from hell&#8230;</h3>




<p>Yeah, but we have to do the clients work, we have to deliver things,
we have to match their expectations, right? You know what&#8230; now
with humongous confidence I can say NO! Clients have ideas, and want
to realize them to check if they&#8217;re ok. <strong>But clients want the designing of
the app to be the validation of their idea</strong> as well. Most
developers used to say:</p>




<blockquote>
Oh, that client wants to do some shitty reports there. We know that&#8217;s
shit but they want to have it, let&#8217;s do it then&#8230;
</blockquote>




<p>But that&#8217;s wrong! <strong>Lean consultants should help the client to find
the best way to validate his product and eliminate waste</strong>. If you
think that something your client wants is a piece of crap and nobody is
going to use it <strong>say it</strong>. Insist to measure user needs. Doing
all the features required by the client super fast doesn&#8217;t equal
being lean. <strong>Being lean means that you are a logical filter for all
the client&#8217;s bad ideas</strong> - this is the very first validation of his
product.</p>




<p>The second problem with the clients is that they used to come with something like this:</p>




<blockquote>
We have an idea for a <strong>Rails application</strong>.
</blockquote>




<p>No motherfucker! You don&#8217;t want to build a Rails app, what you want to
build is <strong>an application</strong>. It may become a Rails app, it may become a
Sinatra app, it may be even a console app, it doesn&#8217;t matter. As I said
before that it is only a delivery method, and from the lean perspective
it&#8217;s nothing else than <strong>waste</strong>. Mocks are friends of lean approach,
<strong>mock everything you can, that&#8217;s the fastest way to see if your potential
users are going to like it or not</strong>.</p>




<h3 id="(C)lean+code...">(C)lean code&#8230;</h3>




<p>You know what, let&#8217;s drink some beer now. But let&#8217;s do it in a
different way. We are going to do it with Ruby today, sorry to all the Gophers
reading this article. I&#8217;ll make some special episode about DDD in Go next
time. We&#8217;re going to start writing the story and tests - that&#8217;s how
TDD, BDD and other *DD variations works. <strong>You have to write tests first</strong>,
otherwise you are just waisting time (eliminate waste, remember?).</p>




<pre><code class="language-gherkin"><span class="k">Feature:</span><span class="nf"> Drinking beer</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Drink a beer</span>
<span class="k">    When </span><span class="nf">I pick a beer</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">I want to drink the beer I choose</span></code></pre>




<p>Let&#8217;s say we want to have a beer drinking service:</p>




<pre><code class="language-ruby"><span class="no">When</span><span class="sr"> /I pick a beer/</span> <span class="k">do</span>
  <span class="vi">@drinking</span> <span class="o">=</span> <span class="no">BeerDrinkingService</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span>

<span class="no">Then</span><span class="sr"> /I want to drink the beer I choose/</span> <span class="k">do</span>
  <span class="vi">@drinking</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">"Pssst! Gulp, gulp, gulp... aaaah!"</span>
<span class="k">end</span></code></pre>




<p>Now we know exactly what we want to do, we need a beer:</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">Beer</span>
  <span class="k">def</span> <span class="nf">drink</span>
    <span class="s2">"Pssst! Gulp, gulp, gulp... aaaah!"</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>




<p>&#8230; and some client who wants to drink it:</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">Client</span>
  <span class="k">def</span> <span class="nf">drink_a_beer</span>
    <span class="no">Beer</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">drink</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>




<p>Finally, we have to provide some way for the client o drink the beer
easily, we need some <strong>interaction</strong>:</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">BeerDrinkingService</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@client</span> <span class="o">=</span> <span class="no">Client</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="vi">@client</span><span class="o">.</span><span class="n">drink_a_beer</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>




<p>And you know what, that&#8217;s already our minimum viable product! We have
a client who can drink a beer, lovely! After we show it to potential clients
they may not want to drink just some random beer. Maybe they want to select
their favorite Scenario first:</p>




<pre><code class="language-gherkin"><span class="k">Feature:</span><span class="nf"> Drining beer</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Drink favorite beer</span>
<span class="k">    When </span><span class="nf">I pick my favorite "</span><span class="s">Belfast</span><span class="nf">" beer</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">I want to drink the beer I choose</span></code></pre>




<p>The tests may looks like this:</p>




<pre><code class="language-ruby"><span class="no">When</span><span class="sr"> /I pick my favorite "(.*)" beer/</span> <span class="k">do</span> <span class="o">|</span><span class="n">beer_brand</span><span class="o">|</span>
  <span class="vi">@drinking</span> <span class="o">=</span> <span class="no">BeerDrinkingService</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">beer_brand</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Then</span><span class="sr"> /I want to drink the beer I choose/</span> <span class="k">do</span>
  <span class="vi">@drinking</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">"Pssst! Gulp, gulp, gulp... aaaah!"</span>
<span class="k">end</span></code></pre>




<p>And the code&#8230;</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">Client</span>
  <span class="k">def</span> <span class="nf">drink_a_beer</span><span class="p">(</span><span class="n">brand</span><span class="p">)</span>
    <span class="no">Beer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">brand</span><span class="p">)</span><span class="o">.</span><span class="n">drink</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Beer</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:brand</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">drink</span>
    <span class="nb">puts</span> <span class="s2">"Pssssst! Gulp, gulp, gulp... aaaah!"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">BeerDrinkingService</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">beer_brand</span><span class="p">)</span>
    <span class="vi">@client</span> <span class="o">=</span> <span class="no">Client</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@beer_brand</span> <span class="o">=</span> <span class="n">beer_brand</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="vi">@client</span><span class="o">.</span><span class="n">drink_a_beer</span><span class="p">(</span><span class="n">beer_brand</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>




<p>Going further, now we may want to know how drunk the guy is. Maybe we
don&#8217;t want to sell him a beer when he looks like a sack of potatoes.
Scenarios, scenarios, scenarios:</p>




<pre><code class="language-gherkin"><span class="k">Feature:</span><span class="nf"> Drining beer</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Drink a favorite beer</span>
<span class="k">    When </span><span class="nf">I pick my favorite "</span><span class="s">Belfast</span><span class="nf">" beer</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">I want to drink the beer I choose</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Getting wasted</span>
<span class="k">    When </span><span class="nf">I drink my favorite "</span><span class="s">Belfast</span><span class="nf">" beer until I look like a sack of potaoes</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">I should not get another beer</span></code></pre>




<p>Tests, tests, tests!</p>




<pre><code class="language-ruby"><span class="no">Then</span><span class="sr"> /I want drink favorite "(.*)" beer until I get look like sack of potaoes/</span> <span class="k">do</span> <span class="o">|</span><span class="n">beer_brand</span><span class="o">|</span>
  <span class="vi">@beer_brand</span> <span class="o">=</span> <span class="n">beer_brand</span>
  <span class="mi">10</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
    <span class="n">step</span><span class="p">(</span><span class="sx">%(I pick my favorite "</span><span class="si">#{</span><span class="vi">@beer_brand</span><span class="si">}</span><span class="sx">" beer)</span><span class="p">)</span>
    <span class="n">step</span><span class="p">(</span><span class="sx">%(I want to drink the beer I choose)</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Then</span><span class="sr"> /I should not get another beer/</span> <span class="k">do</span>
  <span class="n">step</span><span class="p">(</span><span class="sx">%(I pick my favorite "</span><span class="si">#{</span><span class="vi">@beer_brand</span><span class="si">}</span><span class="sx">" beer)</span><span class="p">)</span>
  <span class="vi">@drinking</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
<span class="k">end</span></code></pre>




<p>And the code is growing:</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">Client</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:drunkness</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">drink_a_beer</span><span class="p">(</span><span class="n">brand</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">drunkenness</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="no">Beer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">brand</span><span class="p">)</span><span class="o">.</span><span class="n">drink</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">drunkness</span>
    <span class="vi">@drunkness</span> <span class="o">||=</span> <span class="mi">0</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">waisted?</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">drunkenness</span> <span class="o">&gt;</span> <span class="mi">6</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sack_of_potatoes?</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">drunknness</span> <span class="o">&gt;</span> <span class="mi">9</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">BeerDrinkingService</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">beer_brand</span><span class="p">)</span>
    <span class="vi">@client</span> <span class="o">=</span> <span class="no">ClientsRepository</span><span class="o">.</span><span class="n">find_by_id_or_create</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
    <span class="vi">@beer_brand</span> <span class="o">=</span> <span class="n">beer_brand</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">valid?</span>
    <span class="o">!</span><span class="vi">@client</span><span class="o">.</span><span class="n">sack_of_potatoes?</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">valid?</span>
    <span class="vi">@client</span><span class="o">.</span><span class="n">drink_a_beer</span><span class="p">(</span><span class="vi">@beer_brand</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>




<p>Two new things shown up around the code: the first is validation, thus this
dumb example is enough to return false if someone can&#8217;t drink the
beer. Otherwise we can consider returning some errors hash. In fact,
validations are very hard problem itself. There&#8217;s a holy war about where
do validations should belong to, should they belong to the model like in
ActiveRecord? But this requires dealing with various contexts very often.
To the service, or form? Well, this may cause unncecessery repetition,
and we don&#8217;t want to repeat ourselves. Or maybe validators should be totally separated
objects, service-like callables for checking various requirements on
the passed objects? I personally think that what belongs to model,
should be there, what belongs to service/form should be there. No
mixing contexts, there&#8217;s nothing worse than dealing with extra states.
I think validations itself is a good topic for a future blog post,
stay tuned for it.</p>




<p>The second new thing is <code>ClientsRepository</code>, what&#8217;s that? This is our
proxy to data storage. <strong>Some, undefined data storage</strong>. You shouldn&#8217;t
imagine storage as a database. Storage is just a detail. It may be a
simple Ruby hash. Speaking shortly, <strong>It doesn&#8217;t mather at all</strong>.
Here&#8217;s how our clients repository may look like:</p>




<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">ClientsMockRepository</span>
  <span class="no">DB</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">auto_increment</span>
    <span class="vi">@auto_increment</span> <span class="o">||=</span> <span class="mi">0</span>
    <span class="vi">@auto_increment</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_by_id</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
    <span class="no">DB</span><span class="o">[</span><span class="n">client_id</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span>
    <span class="no">DB</span><span class="o">[</span><span class="n">auto_increment</span><span class="o">]</span> <span class="o">=</span> <span class="no">Client</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_by_id_or_create</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
    <span class="n">find_by_id</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span> <span class="ow">or</span> <span class="n">create</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ClientsRepository</span> <span class="o">&lt;</span> <span class="no">ClientsMockRepository</span>
<span class="k">end</span></code></pre>




<p>Now I can imagine a bunch of people saying, <em>Ohh, but how can I retrieve a list
of all the clients</em>? Let me answer you with a question: Does your domain
model require that feature?</p>




<p>Second thing, you see that <code>ClientsRepository</code> inherits from a mock repository
implementation. That&#8217;s how it works, the repository is just a plugin, when
you decide that you need to have your data persisted, you can just switch
it to MySQL, Redis or whatever other driver you like. You can use global
variable as well, use whatever is cleaner for you:</p>




<pre><code class="language-ruby"><span class="vg">$clients_repository</span> <span class="o">=</span> <span class="no">ClientsMockRepository</span></code></pre>




<p>We can go further and further, checking if the beer is available, charging
the client for his drink, etc. etc. You can play with it at your home -
yeah, treat it as a homework - you will see by yourself how easy is
to implement a new features, changing existing ones and move project forward
when you simply don&#8217;t care about the details - storage, delivery method,
views, etc.</p>




<p>Oh, let me tell ya, <strong>the tests are blazingly fast</strong> no matter if you&#8217;re
using RSpec, Cucumber or God knows what other inventention. But, what&#8217;s way
more important for your clients, it to test what they actually do want to
test. It doesn&#8217;t test GUI or other shit which <strong>doesn&#8217;t matter</strong> at the
moment.</p>




<p>As I said, after a while, when you may need a database, you can simply
write a driver for it, a plugin, because <strong>a database is nothing more
than a plugin</strong>&#8230; The same happens with visual representations, we can
wrap our interaction around with some boundaries, write some presenter
for it, write bunch of Rails spaghetti. We can expose it as a webservice
and present using only JavaScript. There&#8217;s no limits, can you see it now?
<strong>You should always keep as much doors open as possible. Good architectural
decisions allows you to keep doors open</strong>, use it wisely.</p>




<h3 id="Optimize...+pivot?">Optimize&#8230; pivot?</h3>




<p>Well, that&#8217;s all for today. Some of you guys may consider this article
as a pivot against your mindset, for some it may be just optimization,
for many others it may be total bullshit. I will be happy to meet
all of you and listen to your constructive feedback. Maybe your
feedback will cause a pivot in my mindset? For sure it will optimize
it!</p>




<p>At the end, I would like to also thank Cubox for how they helped me to
change my mindset during last year. Thanks to <a href="http://twitter.com/apotonick">apotonick</a>
again! Big thanks to <a href="https://twitter.com/saturnflyer">Jim Gay</a> for his
great talk at wroc_love.rb about DCI - even if I don&#8217;t agree with all the
presented ideas it helped me a lot to clarify mine :P. Also, thanks
to <a href="https://twitter.com/tlossen">Tim Lossen</a> for raising the glove
in the battle between monolythic apps versus web-services I go for,
which caused me to dig deeper and deeper about this topic. I can&#8217;t wait to see
your talk at EuRuKo! And of course thanks to <a href="http://anarchogeek.com">rabble</a>
for infecting me with Lean Startup stuff and making me understand it
in practice.</p>




<p>Like always thanks to <a href="http://twitter.com/poteland">pote</a> for reviewing
my ugly english.</p>




<div class="author">
  <img src="https://twimg0-a.akamaihd.net/profile_images/1964798229/awesome2.jpg" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/nu7hatch">Krzysiek Kowalik</a> - check out <a href="http://areyoufuckingcoding.me">Are You Fucking Coding Me!?</a></i>
  </span>
</div>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/planetTest/blog/2012/03/15/rubydeps-new-gem-by-cuboxer/">Rubydeps - New Gem by Cuboxer</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-15T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of our cuboxers, <a href="http://www.danielcadenas.com/">Daniel Cadenas</a>, released a new version of his <a href="https://github.com/dcadenas/rubydeps">rubydeps</a> gem:</p>




<blockquote><p>A tool to create class dependency graphs from test suites.</p>

<p>I think this is more useful than static analysis of the code base because of the high dynamic aspects of the language.</p></blockquote>




<p>The gem was featured on <a href="http://rubyweekly.com/">Ruby News</a> - Issue 85 and got some upvotes on <a href="http://www.reddit.com/r/ruby/comments/qok1r/rubydeps_091pre_released_a_tool_that_uses/">reddit ruby</a>.</p>




<p>Fork <a href="https://github.com/dcadenas/rubydeps">rubydeps on github</a>.</p>


<div class="author">
  <img src="http://cuboxlabs.com/img/cubox-humans/could-be-you.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Cubox</a> - check out <a href="http://blog.cuboxlabs.com/">Cubox Blog</a></i>
  </span>
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/planetTest/blog/archives">Blog Archives</a>
    
    <a class="next" href="/planetTest/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/planetTest/blog/2013/11/21/">السعودية الدولة الأولى في تويتر</a>
      </li>
    
      <li class="post">
        <a href="/planetTest/blog/2013/11/20/australis/">Australis الواجهة الجديدة لفيرفكس</a>
      </li>
    
      <li class="post">
        <a href="/planetTest/blog/2013/11/13/xenu-link-sleuth/">Xenu Link Sleuth أداة تساعدكم في تحديد الروابط المبهمة</a>
      </li>
    
      <li class="post">
        <a href="/planetTest/blog/2013/11/12/">جيم للتعامل مع واجهة جوجل للترجمة في روبي</a>
      </li>
    
      <li class="post">
        <a href="/planetTest/blog/2013/11/11/">فتح الملفات بروبي</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
